<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lotes Contratuais - SGMRP</title>
    <meta name="description" content="Listagem completa dos lotes contratuais do sistema penitenci√°rio">
    <link rel="stylesheet" href="/static/css/style.css">
</head>
<body>
    <header>
        <div class="container">
            <div class="header-content">
                <a href="{{ url_for('dashboard') }}" class="logo">SGMRP</a>
                <nav>
                    <ul>
                        <li><a href="{{ url_for('dashboard') }}">Dashboard</a></li>
                        <li><a href="{{ url_for('lotes') }}" class="active">Lotes</a></li>
                        <li><a href="#relatorios">Relat√≥rios</a></li>
                        <li><a href="#configuracoes">Configura√ß√µes</a></li>
                        <li><a href="#" id="logoutLink" style="color: #fed7d7;">Sair</a></li>
                    </ul>
                </nav>
            </div>
        </div>
    </header>

    <main>
        <div class="container">
            <!-- Breadcrumb -->
            <nav aria-label="Navega√ß√£o" style="margin-bottom: 2rem;">
                <ol style="display: flex; gap: 0.5rem; font-size: 0.875rem; color: var(--gray-500);">
                    <li><a href="{{ url_for('dashboard') }}" style="color: var(--primary-color); text-decoration: none;">Dashboard</a></li>
                    <li aria-hidden="true">/</li>
                    <li aria-current="page">Lotes Contratuais</li>
                </ol>
            </nav>

            <!-- Header da P√°gina -->
            <section style="margin-bottom: 2rem;">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem; flex-wrap: wrap; gap: 1rem;">
                    <div>
                        <h1>Lotes Contratuais</h1>
                        <p style="color: var(--gray-600); margin: 0;">
                            Gerenciamento completo dos lotes e unidades prisionais
                        </p>
                    </div>
                    <div style="display: flex; gap: 0.75rem;">
                        <!-- Bot√£o Exportar Dados removido -->
                        <button class="btn btn-primary" id="novoLote">
                            ‚ûï Novo Lote
                        </button>
                    </div>
                </div>
            </section>

            <!-- Filtros Avan√ßados -->
            <section class="filters fade-in">
                <h3 style="margin-bottom: 1rem;">Filtros</h3>
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem; margin-bottom: 1rem;">
                    <div>
                        <label for="filtro-status" class="form-label">Status</label>
                        <select id="filtro-status" class="form-select">
                            <option value="">Todos os status</option>
                            <option value="ativo">Ativo</option>
                            <option value="inativo">Inativo</option>
                        </select>
                    </div>
                    <div>
                        <label for="filtro-empresa" class="form-label">Empresa</label>
                        <select id="filtro-empresa" class="form-select">
                            <option value="">Todas as empresas</option>
                            {% for empresa in empresas %}
                                <option value="{{ empresa|lower }}">{{ empresa }}</option>
                            {% endfor %}
                        </select>
                    </div>
                    <div>
                        <label for="filtro-conformidade" class="form-label">Conformidade</label>
                        <select id="filtro-conformidade" class="form-select">
                            <option value="">Todos os n√≠veis</option>
                            <option value="alta">Alta (95%+)</option>
                            <option value="media">M√©dia (85-95%)</option>
                            <option value="baixa">Baixa (&lt;85%)</option>
                        </select>
                    </div>
                </div>
                <div style="display: flex; gap: 0.75rem; justify-content: flex-end;">
                    <button class="btn btn-secondary" id="limparFiltros">Limpar Filtros</button>
                    <button class="btn btn-primary" id="aplicarFiltros">Aplicar Filtros</button>
                </div>
            </section>

            <!-- Resumo dos Resultados -->
            <section style="margin-bottom: 2rem;">
                <div class="card">
                    <div class="card-body" style="padding: 1.5rem;">
                        <div style="display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 1rem;">
                            <div>
                                <span style="font-size: 0.875rem; color: var(--gray-600);">
                                    Exibindo <strong id="resultados-count">{{ lotes|length }}</strong> de <strong>{{ lotes|length }}</strong> lotes
                                </span>
                            </div>
                            <div style="display: flex; gap: 0.5rem; align-items: center;">
                                <span style="font-size: 0.875rem; color: var(--gray-600);">Ordenar por:</span>
                                <select id="ordenacao" class="form-select" style="width: auto; min-width: 150px;">
                                    <option value="nome">Nome</option>
                                    <option value="conformidade">Conformidade</option>
                                    <option value="refeicoes">N¬∫ Refei√ß√µes</option>
                                    <option value="atualizacao">√öltima Atualiza√ß√£o</option>
                                </select>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Lista de Lotes -->
            <section id="lista-lotes">
                {% for lote in lotes %}
                <div class="card fade-in lote-item" data-lote="{{ loop.index }}" data-status="{{ 'ativo' if lote.ativo else 'inativo' }}" data-empresa="{{ lote.empresa|lower }}" data-conformidade="{{ lote.conformidade }}">
                    <div class="card-body" style="padding: 2rem;">
                        <div style="display: grid; grid-template-columns: 1fr auto; gap: 2rem; align-items: start;">
                            <!-- Informa√ß√µes principais -->
                            <div>
                                <div style="display: flex; align-items: center; gap: 1rem; margin-bottom: 1rem;">
                                    <h3 style="margin: 0; color: var(--primary-color);">Lote {{ loop.index }}</h3>
                                    {% if lote.ativo %}
                                    <div class="badge" style="background-color: var(--success-color); color: white; padding: 0.25rem 0.75rem; border-radius: 1rem; font-size: 0.75rem; font-weight: 500;">
                                        ATIVO
                                    </div>
                                    {% else %}
                                    <div class="badge" style="background-color: var(--danger-color); color: white; padding: 0.25rem 0.75rem; border-radius: 1rem; font-size: 0.75rem; font-weight: 500;">
                                        INATIVO
                                    </div>
                                    {% endif %}
                                    <div style="background-color: var(--light-blue); color: var(--primary-color); padding: 0.25rem 0.75rem; border-radius: 1rem; font-size: 0.75rem; font-weight: 500;">
                                        {{ lote.conformidade }}% Conformidade
                                    </div>
                                </div>

                                <div style="margin-bottom: 1.5rem;">
                                    <p style="margin: 0; color: var(--gray-600);">
                                        <strong>Empresa Respons√°vel:</strong> {{ lote.empresa }}
                                    </p>
                                    <p style="margin: 0; color: var(--gray-600);">
                                        <strong>Unidades:</strong> {{ lote.unidades|length }} unidades ativas
                                    </p>
                                    <p style="margin: 0; color: var(--gray-600);">
                                        <strong>√öltima Atualiza√ß√£o:</strong> 18/10/2025 √†s 15:30
                                    </p>
                                </div>

                                <!-- Estat√≠sticas do Lote (simuladas) -->
                                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(120px, 1fr)); gap: 1rem;">
                                    <div style="text-align: center; padding: 1rem; background-color: var(--gray-50); border-radius: var(--border-radius);">
                                        <div style="font-size: 1.25rem; font-weight: 600; color: var(--primary-color);">{{ lote.refeicoes_mes }}</div>
                                        <div style="font-size: 0.75rem; color: var(--gray-600);">Refei√ß√µes/M√™s</div>
                                    </div>
                                    <div style="text-align: center; padding: 1rem; background-color: var(--gray-50); border-radius: var(--border-radius);">
                                        <div style="font-size: 1.25rem; font-weight: 600; color: var(--success-color);">R$ {{ '%.2f'|format(lote.custo_mes) }}</div>
                                        <div style="font-size: 0.75rem; color: var(--gray-600);">Custo/M√™s</div>
                                    </div>
                                    <div style="text-align: center; padding: 1rem; background-color: var(--gray-50); border-radius: var(--border-radius);">
                                        <div style="font-size: 1.25rem; font-weight: 600; color: var(--warning-color);">R$ {{ '%.2f'|format(lote.desvio_mes) }}</div>
                                        <div style="font-size: 0.75rem; color: var(--gray-600);">Desvio/M√™s</div>
                                    </div>
                                    <div style="text-align: center; padding: 1rem; background-color: var(--gray-50); border-radius: var(--border-radius);">
                                        <div style="font-size: 1.25rem; font-weight: 600; color: var(--primary-color);">{{ lote.meses_cadastrados }}</div>
                                        <div style="font-size: 0.75rem; color: var(--gray-600);">Meses Cadastrados</div>
                                    </div>
                                </div>
                            </div>

                            <!-- A√ß√µes -->
                            <div style="display: flex; flex-direction: column; gap: 0.5rem; align-items: stretch; min-width: 150px;">
                                    <a href="{{ url_for('lote_detalhes', lote_id=lote.id) }}" class="btn btn-primary btn-sm">
                                    üîç Ver Detalhes
                                </a>
                                <button class="btn btn-secondary btn-sm" onclick="importarDados({{ loop.index }})">
                                                üì§ Importar Dados
                                          </button>
                                          <button class="btn btn-secondary btn-sm" onclick="alert('Funcionalidade de relat√≥rio para Lote {{ loop.index }} ser√° implementada em vers√µes futuras.')">
                                              üìä Relat√≥rio
                                          </button>
                            </div>
                        </div>
                    </div>
                </div>
                {% endfor %}
            </section>
        </div>
    </main>

    <footer>
        <div class="container text-center">
            <p style="margin: 0; color: var(--gray-400); font-size: 0.875rem;">
                ¬© 2025 SGMRP - Sistema de Gerenciamento de Mapas de Refei√ß√µes Penitenci√°rio
            </p>
        </div>
    </footer>

    <!-- Modal Novo Lote -->

    <div id="modal-novo-lote" style="display: none; position: fixed; top: 0; left: 0; width: 100vw; height: 100vh; background: rgba(0,0,0,0.5); z-index: 2000;">
        <div style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); background: white; border-radius: 16px; padding: 2rem; max-width: 900px; width: 95%; box-shadow: 0 8px 32px rgba(0,0,0,0.18);">
            <h2 style="margin-bottom: 1.5rem; color: var(--primary-color);">Novo Lote Contratual</h2>
            <form id="form-novo-lote" autocomplete="off">
                <div style="display: flex; flex-direction: row; gap: 2rem; margin-bottom: 2rem; flex-wrap: wrap;">
                    <!-- Coluna dos campos de texto -->
                    <div style="flex: 1 1 320px; min-width: 280px; display: flex; flex-direction: column; gap: 1rem;">
                        <div>
                            <label for="novo-lote-nome" class="form-label" style="font-weight: 500;">Nome do Lote</label>
                            <input type="text" id="novo-lote-nome" name="nome_lote" class="form-input" placeholder="Digite o nome do lote" required style="width: 100%; padding: 0.5rem; border-radius: 6px; border: 1px solid var(--gray-300);">
                        </div>
                        <div>
                            <label for="novo-lote-empresa" class="form-label" style="font-weight: 500;">Nome da Empresa</label>
                            <input type="text" id="novo-lote-empresa" name="nome_empresa" class="form-input" placeholder="Digite o nome da empresa" required style="width: 100%; padding: 0.5rem; border-radius: 6px; border: 1px solid var(--gray-300);">
                        </div>
                        <div>
                            <label for="novo-lote-contrato" class="form-label" style="font-weight: 500;">N√∫mero do Contrato</label>
                            <input type="text" id="novo-lote-contrato" name="numero_contrato" class="form-input" placeholder="Digite o n√∫mero do contrato" required style="width: 100%; padding: 0.5rem; border-radius: 6px; border: 1px solid var(--gray-300);">
                        </div>
                        <div>
                            <label for="novo-lote-inicio" class="form-label" style="font-weight: 500;">Data de In√≠cio do Contrato</label>
                            <input type="date" id="novo-lote-inicio" name="data_inicio" class="form-input" required style="width: 100%; padding: 0.5rem; border-radius: 6px; border: 1px solid var(--gray-300);">
                        </div>
                        <div>
                            <label class="form-label" style="font-weight: 500;">Unidades do Lote</label>
                            <div id="unidades-lista" style="display: flex; flex-direction: column; gap: 0.5rem;"></div>
                            <input type="text" id="input-unidade" class="form-input" placeholder="Digite o nome da unidade e pressione Enter" style="width: 100%; padding: 0.5rem; border-radius: 6px; border: 1px solid var(--gray-300); margin-top: 0.5rem;">
                            <small style="color: var(--gray-500);">Pressione Enter para adicionar cada unidade. Clique no X para remover.</small>
                        </div>
                    </div>
                    <!-- Coluna dos pre√ßos -->
                    <div style="flex: 1 1 320px; min-width: 280px; display: flex; flex-direction: column; gap: 1rem;">
                        <label class="form-label" style="font-weight: 500;">Pre√ßos das Refei√ß√µes (R$)</label>
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 0.5rem;">
                            <div>
                                <label for="preco-cafe-interno" style="font-size: 0.95em;">Caf√© Interno</label>
                                <input type="number" step="0.01" min="0" id="preco-cafe-interno" name="preco_cafe_interno" class="form-input" placeholder="0,00" required style="width: 100%; padding: 0.4rem; border-radius: 6px; border: 1px solid var(--gray-300);">
                            </div>
                            <div>
                                <label for="preco-cafe-funcionario" style="font-size: 0.95em;">Caf√© Funcion√°rio</label>
                                <input type="number" step="0.01" min="0" id="preco-cafe-funcionario" name="preco_cafe_funcionario" class="form-input" placeholder="0,00" required style="width: 100%; padding: 0.4rem; border-radius: 6px; border: 1px solid var(--gray-300);">
                            </div>
                            <div>
                                <label for="preco-almoco-interno" style="font-size: 0.95em;">Almo√ßo Interno</label>
                                <input type="number" step="0.01" min="0" id="preco-almoco-interno" name="preco_almoco_interno" class="form-input" placeholder="0,00" required style="width: 100%; padding: 0.4rem; border-radius: 6px; border: 1px solid var(--gray-300);">
                            </div>
                            <div>
                                <label for="preco-almoco-funcionario" style="font-size: 0.95em;">Almo√ßo Funcion√°rio</label>
                                <input type="number" step="0.01" min="0" id="preco-almoco-funcionario" name="preco_almoco_funcionario" class="form-input" placeholder="0,00" required style="width: 100%; padding: 0.4rem; border-radius: 6px; border: 1px solid var(--gray-300);">
                            </div>
                            <div>
                                <label for="preco-lanche-interno" style="font-size: 0.95em;">Lanche Interno</label>
                                <input type="number" step="0.01" min="0" id="preco-lanche-interno" name="preco_lanche_interno" class="form-input" placeholder="0,00" required style="width: 100%; padding: 0.4rem; border-radius: 6px; border: 1px solid var(--gray-300);">
                            </div>
                            <div>
                                <label for="preco-lanche-funcionario" style="font-size: 0.95em;">Lanche Funcion√°rio</label>
                                <input type="number" step="0.01" min="0" id="preco-lanche-funcionario" name="preco_lanche_funcionario" class="form-input" placeholder="0,00" required style="width: 100%; padding: 0.4rem; border-radius: 6px; border: 1px solid var(--gray-300);">
                            </div>
                            <div>
                                <label for="preco-jantar-interno" style="font-size: 0.95em;">Jantar Interno</label>
                                <input type="number" step="0.01" min="0" id="preco-jantar-interno" name="preco_jantar_interno" class="form-input" placeholder="0,00" required style="width: 100%; padding: 0.4rem; border-radius: 6px; border: 1px solid var(--gray-300);">
                            </div>
                            <div>
                                <label for="preco-jantar-funcionario" style="font-size: 0.95em;">Jantar Funcion√°rio</label>
                                <input type="number" step="0.01" min="0" id="preco-jantar-funcionario" name="preco_jantar_funcionario" class="form-input" placeholder="0,00" required style="width: 100%; padding: 0.4rem; border-radius: 6px; border: 1px solid var(--gray-300);">
                            </div>
                        </div>
                    </div>
                </div>
                <div style="display: flex; gap: 0.75rem; justify-content: flex-end;">
                    <button type="button" id="btn-cancelar-novo-lote" class="btn btn-secondary">Cancelar</button>
                    <button type="submit" id="btn-adicionar-novo-lote" class="btn btn-primary">Adicionar</button>
                </div>
            </form>
        </div>
    </div>

    <script>
        // Campo din√¢mico de unidades do lote
        function adicionarCampoUnidade(nome = "") {
            const lista = document.getElementById('unidades-lista');
            const div = document.createElement('div');
            div.style.display = 'flex';
            div.style.alignItems = 'center';
            div.style.gap = '0.5rem';
            div.className = 'unidade-item';
            const input = document.createElement('input');
            input.type = 'text';
            input.className = 'form-input';
            input.value = nome;
            input.name = 'unidades[]';
            input.placeholder = 'Nome da unidade';
            input.required = true;
            input.style.flex = '1';
            input.style.padding = '0.5rem';
            input.style.borderRadius = '6px';
            input.style.border = '1px solid var(--gray-300)';
            const btnRemover = document.createElement('button');
            btnRemover.type = 'button';
            btnRemover.textContent = '‚úñ';
            btnRemover.title = 'Remover unidade';
            btnRemover.style.background = 'none';
            btnRemover.style.border = 'none';
            btnRemover.style.color = '#e53e3e';
            btnRemover.style.fontSize = '1.1rem';
            btnRemover.style.cursor = 'pointer';
            btnRemover.addEventListener('click', function() {
                lista.removeChild(div);
            });
            div.appendChild(input);
            div.appendChild(btnRemover);
            lista.appendChild(div);
        }

        document.addEventListener('DOMContentLoaded', function() {
            // Campo de adicionar unidade din√¢mica
            var inputUnidade = document.getElementById('input-unidade');
            if (inputUnidade) {
                inputUnidade.addEventListener('keydown', function(e) {
                    if (e.key === 'Enter') {
                        e.preventDefault();
                        const nome = inputUnidade.value.trim();
                        if (nome.length > 0) {
                            adicionarCampoUnidade(nome);
                            inputUnidade.value = '';
                        }
                    }
                });
            }
            // Verificar autentica√ß√£o
            const usuarioSalvo = localStorage.getItem('sgmrp_usuario');
            if (!usuarioSalvo) {
                alert('Sess√£o expirada. Redirecionando para login.');
                window.location.href = 'login.html';
                return;
            }

            // Logout
            var logoutBtn = document.getElementById('logoutLink');
            if (logoutBtn) {
                logoutBtn.addEventListener('click', function(e) {
                    e.preventDefault();
                    if (confirm('Tem certeza que deseja sair do sistema?')) {
                        localStorage.removeItem('sgmrp_usuario');
                        localStorage.removeItem('sgmrp_remember');
                        window.location.href = 'login.html';
                    }
                });
            }

            // Busca em tempo real
            var buscaInput = document.getElementById('filtro-busca-lote');
            if (buscaInput) {
                buscaInput.addEventListener('input', function() {
                    applyFilters();
                });
            }

            // Ordena√ß√£o
            var ordenacaoSelect = document.getElementById('ordenacao');
            if (ordenacaoSelect) {
                ordenacaoSelect.addEventListener('change', function() {
                    sortLotes(this.value);
                });
            }

            // Aplicar filtros
            var aplicarFiltrosBtn = document.getElementById('aplicarFiltros');
            if (aplicarFiltrosBtn) {
                aplicarFiltrosBtn.addEventListener('click', applyFilters);
            }
            var limparFiltrosBtn = document.getElementById('limparFiltros');
            if (limparFiltrosBtn) {
                limparFiltrosBtn.addEventListener('click', clearFilters);
            }

            // Bot√£o Novo Lote - abrir modal
            var novoLoteBtn = document.getElementById('novoLote');
            var modalNovoLote = document.getElementById('modal-novo-lote');
            var btnCancelarNovoLote = document.getElementById('btn-cancelar-novo-lote');
            var btnAdicionarNovoLote = document.getElementById('btn-adicionar-novo-lote');
            if (novoLoteBtn && modalNovoLote) {
                novoLoteBtn.addEventListener('click', function() {
                    modalNovoLote.style.display = 'block';
                });
            }
            if (btnCancelarNovoLote && modalNovoLote) {
                btnCancelarNovoLote.addEventListener('click', function() {
                    modalNovoLote.style.display = 'none';
                });
            }
            if (btnAdicionarNovoLote && modalNovoLote) {
                // Substituir o submit padr√£o para n√£o recarregar a p√°gina
                var formNovoLote = document.getElementById('form-novo-lote');
                if (formNovoLote) {
                    formNovoLote.addEventListener('submit', async function(e) {
                        e.preventDefault();
                        // Coletar dados do formul√°rio
                        const nome_lote = document.getElementById('novo-lote-nome').value.trim();
                        const nome_empresa = document.getElementById('novo-lote-empresa').value.trim();
                        const numero_contrato = document.getElementById('novo-lote-contrato').value.trim();
                        const data_inicio = document.getElementById('novo-lote-inicio').value;
                        // Unidades
                        const unidades = Array.from(document.querySelectorAll('#unidades-lista input[name="unidades[]"]')).map(i => i.value.trim()).filter(Boolean);
                        // Pre√ßos
                        const precos = {
                            cafe: {
                                interno: document.getElementById('preco-cafe-interno').value,
                                funcionario: document.getElementById('preco-cafe-funcionario').value
                            },
                            almoco: {
                                interno: document.getElementById('preco-almoco-interno').value,
                                funcionario: document.getElementById('preco-almoco-funcionario').value
                            },
                            lanche: {
                                interno: document.getElementById('preco-lanche-interno')?.value || '',
                                funcionario: document.getElementById('preco-lanche-funcionario')?.value || ''
                            },
                            jantar: {
                                interno: document.getElementById('preco-jantar-interno')?.value || '',
                                funcionario: document.getElementById('preco-jantar-funcionario')?.value || ''
                            }
                        };
                        // Valida√ß√£o b√°sica
                        if (!nome_lote || !nome_empresa || !numero_contrato || !data_inicio || unidades.length === 0) {
                            alert('Preencha todos os campos obrigat√≥rios.');
                            return;
                        }
                        // Enviar para backend
                        try {
                            const resp = await fetch('/api/novo-lote', {
                                method: 'POST',
                                headers: { 'Content-Type': 'application/json' },
                                credentials: 'same-origin', // Garante envio do cookie de sess√£o Flask
                                body: JSON.stringify({ nome_lote, nome_empresa, numero_contrato, data_inicio, precos, unidades })
                            });
                            const data = await resp.json();
                            if (resp.ok && data.success) {
                                alert('Lote cadastrado com sucesso!');
                                modalNovoLote.style.display = 'none';
                                window.location.reload();
                            } else {
                                alert(data.error || 'Erro ao cadastrar lote.');
                            }
                        } catch (err) {
                            alert('Erro de conex√£o com o servidor.');
                        }
                    });
                }
            }
            // Fechar modal ao clicar fora do conte√∫do
            if (modalNovoLote) {
                modalNovoLote.addEventListener('click', function(e) {
                    if (e.target === modalNovoLote) {
                        modalNovoLote.style.display = 'none';
                    }
                });
            }

            // Bot√£o Exportar Dados (se existir)
            var exportarDadosBtn = document.getElementById('exportarDados');
            if (exportarDadosBtn) {
                exportarDadosBtn.addEventListener('click', function() {
                    alert('Funcionalidade de exporta√ß√£o ser√° implementada em vers√µes futuras.\n\nFormatos dispon√≠veis: Excel, PDF, CSV');
                });
            }

            // Anima√ß√µes
            const observerOptions = {
                threshold: 0.1,
                rootMargin: '0px 0px -50px 0px'
            };
            const observer = new IntersectionObserver((entries) => {
                entries.forEach(entry => {
                    if (entry.isIntersecting) {
                        entry.target.style.opacity = '1';
                        entry.target.style.transform = 'translateY(0)';
                    }
                });
            }, observerOptions);
            document.querySelectorAll('.fade-in').forEach(el => {
                el.style.opacity = '0';
                el.style.transform = 'translateY(30px)';
                el.style.transition = 'opacity 0.6s ease, transform 0.6s ease';
                observer.observe(el);
            });

            // Placeholder para links de relat√≥rios e configura√ß√µes
            document.addEventListener('click', function(e) {
                if (e.target.closest('a[href="#relatorios"]')) {
                    e.preventDefault();
                    alert('M√≥dulo de Relat√≥rios ser√° implementado na pr√≥xima vers√£o do SGMRP.');
                }
                if (e.target.closest('a[href="#configuracoes"]')) {
                    e.preventDefault();
                    alert('M√≥dulo de Configura√ß√µes ser√° implementado na pr√≥xima vers√£o do SGMRP.');
                }
            });
        });

        function applyFilters() {
            const busca = document.getElementById('filtro-busca-lote')?.value.toLowerCase() || '';
            const status = document.getElementById('filtro-status')?.value || '';
            const empresa = document.getElementById('filtro-empresa')?.value || '';
            const conformidade = document.getElementById('filtro-conformidade')?.value || '';

            const lotes = document.querySelectorAll('.lote-item');
            let visibleCount = 0;

            lotes.forEach(lote => {
                let show = true;

                // Filtro de busca
                if (busca) {
                    const text = lote.textContent.toLowerCase();
                    show = show && text.includes(busca);
                }

                // Filtro de status
                if (status) {
                    show = show && lote.dataset.status === status;
                }

                // Filtro de empresa
                if (empresa) {
                    show = show && lote.dataset.empresa === empresa;
                }

                // Filtro de conformidade
                if (conformidade) {
                    const conf = parseFloat(lote.dataset.conformidade);
                    switch(conformidade) {
                        case 'alta':
                            show = show && conf >= 95;
                            break;
                        case 'media':
                            show = show && conf >= 85 && conf < 95;
                            break;
                        case 'baixa':
                            show = show && conf < 85;
                            break;
                    }
                }

                if (show) {
                    lote.style.display = 'block';
                    visibleCount++;
                } else {
                    lote.style.display = 'none';
                }
            });

            var resultadosCount = document.getElementById('resultados-count');
            if (resultadosCount) {
                resultadosCount.textContent = visibleCount;
            }
        }

        function clearFilters() {
            if (document.getElementById('filtro-busca-lote')) document.getElementById('filtro-busca-lote').value = '';
            if (document.getElementById('filtro-status')) document.getElementById('filtro-status').value = '';
            if (document.getElementById('filtro-empresa')) document.getElementById('filtro-empresa').value = '';
            if (document.getElementById('filtro-conformidade')) document.getElementById('filtro-conformidade').value = '';
            applyFilters();
        }

        function sortLotes(criteria) {
            const container = document.getElementById('lista-lotes');
            const lotes = Array.from(container.querySelectorAll('.lote-item'));

            lotes.sort((a, b) => {
                switch(criteria) {
                    case 'nome':
                        const nomeA = a.querySelector('h3').textContent;
                        const nomeB = b.querySelector('h3').textContent;
                        return nomeA.localeCompare(nomeB);
                    case 'conformidade':
                        const confA = parseFloat(a.dataset.conformidade);
                        const confB = parseFloat(b.dataset.conformidade);
                        return confB - confA; // Decrescente
                    case 'refeicoes':
                        const refA = parseInt(a.querySelector('[data-refeicoes]')?.dataset.refeicoes || a.textContent.match(/(\d+,\d+)/)?.[1]?.replace(',', '') || '0');
                        const refB = parseInt(b.querySelector('[data-refeicoes]')?.dataset.refeicoes || b.textContent.match(/(\d+,\d+)/)?.[1]?.replace(',', '') || '0');
                        return refB - refA; // Decrescente
                    case 'atualizacao':
                        return Math.random() - 0.5;
                    default:
                        return 0;
                }
            });

            lotes.forEach(lote => container.removeChild(lote));
            lotes.forEach(lote => container.appendChild(lote));
        }

        function importarDados(loteId) {
            alert(`Funcionalidade de importa√ß√£o de dados para Lote ${loteId} ser√° implementada em vers√µes futuras.`);
        }

        function gerarRelatorio(loteId) {
            alert(`Funcionalidade de relat√≥rio para Lote ${loteId} ser√° implementada em vers√µes futuras.`);
        }
    </script>
    <script type="module">
    // Import the functions you need from the SDKs you need
    import { initializeApp } from "https://www.gstatic.com/firebasejs/12.5.0/firebase-app.js";
    import { getAnalytics } from "https://www.gstatic.com/firebasejs/12.5.0/firebase-analytics.js";
    // TODO: Add SDKs for Firebase products that you want to use
    // https://firebase.google.com/docs/web/setup#available-libraries

    // Your web app's Firebase configuration
    // For Firebase JS SDK v7.20.0 and later, measurementId is optional
    const firebaseConfig = {
        apiKey: "AIzaSyAp2Xg1g5MwxuD3m6QlroJVmi6V6SEYeGo",
        authDomain: "sgmrp-sfa-seap.firebaseapp.com",
        projectId: "sgmrp-sfa-seap",
        storageBucket: "sgmrp-sfa-seap.firebasestorage.app",
        messagingSenderId: "890046403125",
        appId: "1:890046403125:web:36c3cb60d4e6960f1a977c",
        measurementId: "G-Z0KXSCHS4Q"
    };

    // Initialize Firebase
    const app = initializeApp(firebaseConfig);
    const analytics = getAnalytics(app);
    </script>
</body>
</html>